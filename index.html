<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>레전드 갈드컵 생성기</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            line-height: 1.6;
        }
        h1 {
            color: #ffffff;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        p {
            color: #b0b0b0;
            text-align: center;
        }
        label {
            display: block;
            margin: 10px 0 5px;
            color: #cccccc;
        }
        input[type="text"] {
            width: 100%;
            padding: 12px;
            background-color: #1e1e1e;
            border: 1px solid #333333;
            border-radius: 6px;
            color: #ffffff;
            font-size: 1em;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
            transition: border-color 0.3s;
        }
        input[type="text"]:focus {
            border-color: #4a90e2;
            outline: none;
        }
        button {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #4a90e2;
            border: none;
            border-radius: 6px;
            color: #ffffff;
            font-size: 1em;
            cursor: pointer;
            margin: 20px 0;
            transition: background-color 0.3s, transform 0.1s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        button:hover {
            background-color: #357abd;
            transform: translateY(-2px);
        }
        button:active {
            transform: translateY(0);
        }
        #loading {
            display: none;
            text-align: center;
            color: #888888;
            font-style: italic;
            margin: 20px 0;
        }
        #loading::after {
            content: '';
            display: inline-block;
            width: 8px;
            height: 8px;
            margin-left: 10px;
            border-radius: 50%;
            border: 2px solid #888888;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        #result {
            background-color: #1e1e1e;
            border: 1px solid #333333;
            border-radius: 6px;
            padding: 20px;
            margin-top: 20px;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 500px;
            overflow-y: auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        #result:empty {
            display: none;
        }
    </style>
</head>
<body>
    <h1>VS</h1>
    <p>원하는 캐릭터의 이름을 입력하면 누가 더 강력한지 알려드립니다.</p>
    
    <label for="char1">캐릭터 1:</label>
    <input type="text" id="char1" placeholder="예수" required>
    
    <label for="char2">캐릭터 2:</label>
    <input type="text" id="char2" placeholder="모세" required>
    
    <button onclick="generateStory()">스토리 생성</button>
    
    <div id="loading">로딩 중...</div>
    <div id="result"></div>

    <script>
        async function generateStory() {
            const char1 = document.getElementById('char1').value.trim();
            const char2 = document.getElementById('char2').value.trim();
            if (!char1 || !char2) {
                alert('두 캐릭터 이름을 모두 입력하세요!');
                return;
            }

            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            loading.style.display = 'block';
            result.innerHTML = '';
            result.style.display = 'block';

            try {
                // Serper API 키
                const serperApiKey = '523df9636c91a799bf4a8b991293d19a17b30386';

                // Serper API로 캐릭터 1 정보 검색
                const searchResponse1 = await fetch('https://google.serper.dev/search', {
                    method: 'POST',
                    headers: {
                        'X-API-KEY': serperApiKey,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ q: `${char1} 캐릭터 강점 약점 배경 능력` })
                });
                if (!searchResponse1.ok) {
                    throw new Error('Serper API 호출 실패 (캐릭터 1): ' + searchResponse1.statusText);
                }
                const searchData1 = await searchResponse1.json();
                const info1 = searchData1.organic ? searchData1.organic.slice(0, 5).map(item => `${item.title}: ${item.snippet}`).join('\n') : '정보 없음';

                // Serper API로 캐릭터 2 정보 검색
                const searchResponse2 = await fetch('https://google.serper.dev/search', {
                    method: 'POST',
                    headers: {
                        'X-API-KEY': serperApiKey,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ q: `${char2} 캐릭터 강점 약점 배경 능력` })
                });
                if (!searchResponse2.ok) {
                    throw new Error('Serper API 호출 실패 (캐릭터 2): ' + searchResponse2.statusText);
                }
                const searchData2 = await searchResponse2.json();
                const info2 = searchData2.organic ? searchData2.organic.slice(0, 5).map(item => `${item.title}: ${item.snippet}`).join('\n') : '정보 없음';

                // Groq API 키
                const apiKey = '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';

                // 프롬프트: 검색된 정보를 포함하여 분석
                const prompt = `${char1}와 ${char2}에 대한 작중 정보, 혹은 사람들의 평가를 검색하여 심층적으로 분석할 것. 마크다운을 사용하지 않고 답변할 것. 웬만해서는 1000자 정도의 분량으로 작성해야 하나, 필요에 따라 범위를 너무 벗어나지 않는 선에서 적절히 작성할 것. 모든 내용은 한글로 작성할 것. 각 캐릭터의 강점, 약점, 배경을 분석하고, 이 둘이 싸운다면 누가 이길지 논리적으로 추론할 것. 승패 이유를 구체적으로 설명하되, 단순한 설명문이 아니라 전체를 재미있는 짧은 스토리 형식으로 서사를 입혀서 작성할 것. 추가 정보 활용: ${char1}에 대한 정보: ${info1}. ${char2}에 대한 정보: ${info2}. 이 추가 정보를 바탕으로 더 정확하고 품질 높은 분석을 할 것.`;

                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'openai/gpt-oss-120b',
                        messages: [{ role: 'user', content: prompt }],
                        max_tokens: 4096,
                        temperature: 0.7,
                        stream: true
                    })
                });

                if (!response.ok) {
                    throw new Error('Groq API 호출 실패: ' + response.statusText + '. API 키 유효성이나 네트워크 상태를 확인하세요.');
                }

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let done = false;
                let buffer = '';

                while (!done) {
                    const { value, done: readerDone } = await reader.read();
                    done = readerDone;
                    if (value) {
                        buffer += decoder.decode(value, { stream: true });
                        let lines = buffer.split('\n');
                        buffer = lines.pop();

                        for (let line of lines) {
                            if (line.startsWith('data: ')) {
                                const data = line.slice(6);
                                if (data === '[DONE]') continue;
                                try {
                                    const parsed = JSON.parse(data);
                                    const content = parsed.choices[0].delta.content;
                                    if (content) {
                                        result.innerHTML += content.replace(/\n/g, '<br>');
                                        result.scrollTop = result.scrollHeight;
                                    }
                                } catch (e) {
                                    console.error('JSON 파싱 오류:', e);
                                }
                            }
                        }
                    }
                }

                if (result.innerHTML.trim() === '') {
                    result.innerHTML = '캐릭터 분석을 완료하지 못했습니다. 입력을 다시 확인하거나 나중에 시도해주세요.';
                }
            } catch (error) {
                result.innerHTML = '오류 발생: ' + error.message + '<br>API 키나 네트워크를 확인하세요.';
                result.style.color = '#ff4d4d';
            } finally {
                loading.style.display = 'none';
            }
        }
    </script>
</body>
</html>
